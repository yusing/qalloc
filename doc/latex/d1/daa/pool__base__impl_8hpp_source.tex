\hypertarget{pool__base__impl_8hpp_source}{}\doxysection{pool\+\_\+base\+\_\+impl.\+hpp}
\label{pool__base__impl_8hpp_source}\index{F:/Documents/Projects/qalloc/include/qalloc/internal/pool\_base\_impl.hpp@{F:/Documents/Projects/qalloc/include/qalloc/internal/pool\_base\_impl.hpp}}
\mbox{\hyperlink{pool__base__impl_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00001}00001 \textcolor{comment}{// Copyright 2022 yusing. All rights reserved.}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00002}00002 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00003}00003 \textcolor{comment}{// Licensed under the Apache License, Version 2.0 (the "{}License"{});}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00004}00004 \textcolor{comment}{// you may not use this file except in compliance with the License.}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00005}00005 \textcolor{comment}{// You may obtain a copy of the License at}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00006}00006 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00007}00007 \textcolor{comment}{//     http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00008}00008 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00009}00009 \textcolor{comment}{// Unless required by applicable law or agreed to in writing, software}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00010}00010 \textcolor{comment}{// distributed under the License is distributed on an "{}AS IS"{} BASIS,}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00011}00011 \textcolor{comment}{// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00012}00012 \textcolor{comment}{// See the License for the specific language governing permissions and}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00013}00013 \textcolor{comment}{// limitations under the License.}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00014}00014 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00019}00019 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00020}00020 \textcolor{preprocessor}{\#ifndef QALLOC\_POOL\_BASE\_IMPL\_HPP}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00021}00021 \textcolor{preprocessor}{\#define QALLOC\_POOL\_BASE\_IMPL\_HPP}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00022}00022 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00023}00023 \textcolor{preprocessor}{\#include <algorithm>} \textcolor{comment}{// std::find\_if}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00024}00024 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{pool__base_8hpp}{qalloc/internal/pool\_base.hpp}}>}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00025}00025 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{debug__log_8hpp}{qalloc/internal/debug\_log.hpp}}>}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00026}00026 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{memory_8hpp}{qalloc/internal/memory.hpp}}>}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00027}00027 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{type__info_8hpp}{qalloc/internal/type\_info.hpp}}>}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00028}00028 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00029}00029 \mbox{\hyperlink{defs_8hpp_a0c5e46377ecf7e33c016739291f04c75}{QALLOC\_BEGIN}}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00030}00030 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00031}\mbox{\hyperlink{classqalloc_1_1pool__base__t_af427c8f9b09137234b3cf6d6eb2ebade}{00031}} \textcolor{keyword}{inline} pool\_base\_t::pool\_base\_t(\mbox{\hyperlink{namespaceqalloc_a5b36ec8e13ab5c8aebd049e1b0e07574}{size\_type}} byte\_size)}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00032}00032     : m\_subpools       (1\_z, new\_subpool(byte\_size)),}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00033}00033       m\_cur\_subpool    (\&m\_subpools.front()),}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00034}\mbox{\hyperlink{classqalloc_1_1pool__t_af427c8f9b09137234b3cf6d6eb2ebade}{00034}}       m\_freed\_blocks   (),}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00035}00035       m\_pool\_total     (byte\_size)}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00036}00036 \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00037}00037     \mbox{\hyperlink{defs_8hpp_a9be58a357a6e5331cf1ea72c7a65f315}{QALLOC\_ASSERT}}(byte\_size > 0);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00038}00038     \mbox{\hyperlink{defs_8hpp_a9be58a357a6e5331cf1ea72c7a65f315}{QALLOC\_ASSERT}}(!m\_subpools.empty());}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00039}00039     \mbox{\hyperlink{defs_8hpp_a9be58a357a6e5331cf1ea72c7a65f315}{QALLOC\_ASSERT}}(m\_cur\_subpool != \textcolor{keyword}{nullptr});}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00040}00040     \mbox{\hyperlink{debug__log_8hpp_afde3f42696113719c9ae35507125ee6e}{debug\_log}}(\textcolor{stringliteral}{"{}[pool] pool of \%zu bytes constructed\(\backslash\)n"{}}, byte\_size);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00041}00041 \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00042}00042 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00043}\mbox{\hyperlink{classqalloc_1_1pool__base__t_aaa45920cd3d24ca4ec1702afdba64bc2}{00043}} \textcolor{keyword}{inline} pool\_base\_t::\string~pool\_base\_t() \{ \textcolor{comment}{// TODO: fix, never triggers, but does not affect program behavior}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00044}00044     \mbox{\hyperlink{debug__log_8hpp_afde3f42696113719c9ae35507125ee6e}{debug\_log}}(\textcolor{stringliteral}{"{}\%s\(\backslash\)n"{}}, \textcolor{stringliteral}{"{}[pool] pool destructed"{}});}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00045}00045     \mbox{\hyperlink{defs_8hpp_a92e808d95e376699a51e80dba29f5c16}{QALLOC\_DEBUG\_STATEMENT}}(print\_info(\textcolor{keyword}{true});)}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00046}00046     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& subpool : m\_subpools) \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00047}00047         \mbox{\hyperlink{memory_8hpp_a3dd12bc4507909ad9e011d4cb70d9ce2}{q\_free}}(\mbox{\hyperlink{namespaceqalloc_1_1pointer_ab3e62123693cfbbc5b22ce054e388e7a}{pointer::remove\_const}}(subpool.begin));}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00048}00048     \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00049}00049 \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00050}00050 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00051}\mbox{\hyperlink{classqalloc_1_1pool__base__t_aac9b0d244cde9ac12397ab83eaf058be}{00051}} \textcolor{keyword}{inline} \mbox{\hyperlink{structqalloc_1_1subpool__t}{subpool\_t}} pool\_base\_t::new\_subpool(\mbox{\hyperlink{namespaceqalloc_a5b36ec8e13ab5c8aebd049e1b0e07574}{size\_type}} n\_bytes) \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00052}00052     \mbox{\hyperlink{defs_8hpp_abd9d01a9bdcdb529f52d7d9e3e44b552}{QALLOC\_RESTRICT}} \mbox{\hyperlink{namespaceqalloc_ae3a2d1ddce51c70146088378000a5946}{byte\_pointer}} begin = \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{namespaceqalloc_ae3a2d1ddce51c70146088378000a5946}{byte\_pointer}}\textcolor{keyword}{>}(\mbox{\hyperlink{namespaceqalloc_a3814825bf67bbfcbb1078b176f47333e}{q\_malloc}}(n\_bytes)); \textcolor{comment}{// NOLINT(modernize-\/use-\/auto)}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00053}00053     \mbox{\hyperlink{defs_8hpp_abd9d01a9bdcdb529f52d7d9e3e44b552}{QALLOC\_RESTRICT}} \mbox{\hyperlink{namespaceqalloc_ae3a2d1ddce51c70146088378000a5946}{byte\_pointer}} end   = begin + n\_bytes;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00054}00054     \textcolor{keywordflow}{return} \mbox{\hyperlink{structqalloc_1_1subpool__t}{subpool\_t}}\{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00055}00055         begin,  \textcolor{comment}{// .begin}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00056}00056         end,    \textcolor{comment}{// .end}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00057}00057         begin,  \textcolor{comment}{// .current}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00058}00058         n\_bytes \textcolor{comment}{// .size}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00059}00059     \};}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00060}00060 \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00061}00061 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00062}\mbox{\hyperlink{classqalloc_1_1pool__base__t_a9e3a7206d91ec520c5f95da828d1fdb0}{00062}} \textcolor{keyword}{inline} \mbox{\hyperlink{namespaceqalloc_ae3a2d1ddce51c70146088378000a5946}{byte\_pointer}} pool\_base\_t::allocate(\mbox{\hyperlink{namespaceqalloc_a5b36ec8e13ab5c8aebd049e1b0e07574}{size\_type}} n\_bytes)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00063}00063     \mbox{\hyperlink{defs_8hpp_a9be58a357a6e5331cf1ea72c7a65f315}{QALLOC\_ASSERT}}(n\_bytes > 0);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00064}00064     \textcolor{comment}{// if current pool cannot allocate n\_bytes}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00065}00065     \textcolor{comment}{// no need to check the freed blocks (assumed they are smaller than n\_bytes)}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00066}00066     \textcolor{keywordflow}{if} (can\_allocate(n\_bytes)) \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00067}00067         \textcolor{comment}{// try to find a q\_free block in the freed blocks list}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00068}00068         \textcolor{keyword}{auto} it = std::find\_if(}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00069}00069                 m\_freed\_blocks.begin(),}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00070}00070                 m\_freed\_blocks.end(),}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00071}00071                 [n\_bytes](\textcolor{keyword}{const} \mbox{\hyperlink{structqalloc_1_1freed__block__t}{freed\_block\_t}}\& block) \{ \textcolor{comment}{// find a block with enough space}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00072}00072                     return block.n\_bytes >= n\_bytes;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00073}00073                 \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00074}00074         );}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00075}00075         \textcolor{keywordflow}{if} (it != m\_freed\_blocks.end()) \{ \textcolor{comment}{// found a block with enough space}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00076}00076             \mbox{\hyperlink{defs_8hpp_a9be58a357a6e5331cf1ea72c7a65f315}{QALLOC\_ASSERT}}(it-\/>n\_bytes != 0);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00077}00077             \mbox{\hyperlink{defs_8hpp_a9be58a357a6e5331cf1ea72c7a65f315}{QALLOC\_ASSERT}}(it-\/>address != \textcolor{keyword}{nullptr});}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00078}00078             \mbox{\hyperlink{structqalloc_1_1freed__block__t}{freed\_block\_t}} reused\_block = *it;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00079}00079             m\_freed\_blocks.erase(it);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00080}00080             \textcolor{keywordflow}{if} (reused\_block.\mbox{\hyperlink{structqalloc_1_1freed__block__t_a88c05f31a456e68321591a24f2aa0d71}{n\_bytes}} > n\_bytes) \{ \textcolor{comment}{// split if it has extra space left}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00081}00081                 \textcolor{comment}{// deallocate the first (reused\_block.n\_bytes -\/ n\_bytes) bytes}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00082}00082                 \mbox{\hyperlink{namespaceqalloc_a5b36ec8e13ab5c8aebd049e1b0e07574}{size\_type}} size\_left = reused\_block.\mbox{\hyperlink{structqalloc_1_1freed__block__t_a88c05f31a456e68321591a24f2aa0d71}{n\_bytes}} -\/ n\_bytes;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00083}00083                 deallocate(reused\_block.\mbox{\hyperlink{structqalloc_1_1freed__block__t_a8a4dfbdc1d17b95e82c0d0c141288b48}{address}}, size\_left);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00084}00084                 \textcolor{comment}{// and then reuse from the last n\_bytes bytes of the block}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00085}00085                 \textcolor{comment}{// to keep block info (i.e. subpool index and type info) at the beginning of the block}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00086}00086                 reused\_block.\mbox{\hyperlink{structqalloc_1_1freed__block__t_a8a4dfbdc1d17b95e82c0d0c141288b48}{address}} += size\_left;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00087}00087             \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00088}00088             \mbox{\hyperlink{debug__log_8hpp_afde3f42696113719c9ae35507125ee6e}{debug\_log}}(\textcolor{stringliteral}{"{}[allocate] reused freed block of \%zu bytes and has \%zu bytes left @ \%p (Thread \%zu Subpool \%zu)\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00089}00089                       reused\_block.\mbox{\hyperlink{structqalloc_1_1freed__block__t_a88c05f31a456e68321591a24f2aa0d71}{n\_bytes}}, reused\_block.\mbox{\hyperlink{structqalloc_1_1freed__block__t_a88c05f31a456e68321591a24f2aa0d71}{n\_bytes}} -\/ n\_bytes, reused\_block.\mbox{\hyperlink{structqalloc_1_1freed__block__t_a8a4dfbdc1d17b95e82c0d0c141288b48}{address}}, thread\_id(),}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00090}00090                       m\_subpools.size());}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00091}00091             \mbox{\hyperlink{defs_8hpp_a9be58a357a6e5331cf1ea72c7a65f315}{QALLOC\_ASSERT}}(reused\_block.\mbox{\hyperlink{structqalloc_1_1freed__block__t_a8a4dfbdc1d17b95e82c0d0c141288b48}{address}} != \textcolor{keyword}{nullptr});}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00092}00092             \textcolor{keywordflow}{return} reused\_block.\mbox{\hyperlink{structqalloc_1_1freed__block__t_a8a4dfbdc1d17b95e82c0d0c141288b48}{address}};}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00093}00093         \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00094}00094     \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00095}00095     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00096}00096         \textcolor{comment}{// memory exhausted in pool}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00097}00097         \textcolor{comment}{// add new subpool with 2 * (n\_bytes || m\_cur\_subpool-\/>size) (larger one)}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00098}00098         add\_subpool(std::max(n\_bytes * 2, m\_cur\_subpool-\/>size * 2));}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00099}00099     \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00100}00100 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00101}00101     \mbox{\hyperlink{namespaceqalloc_ae3a2d1ddce51c70146088378000a5946}{byte\_pointer}} address = \mbox{\hyperlink{namespaceqalloc_1_1pointer_a595422cf79a1a54d0b8665423d6f717d}{pointer::launder}}(m\_cur\_subpool-\/>pos);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00102}00102     \textcolor{comment}{// move the current pointer}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00103}00103     m\_cur\_subpool-\/>pos += n\_bytes;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00104}00104     \mbox{\hyperlink{defs_8hpp_a9be58a357a6e5331cf1ea72c7a65f315}{QALLOC\_ASSERT}}(address != \textcolor{keyword}{nullptr});}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00105}00105 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00106}00106     \mbox{\hyperlink{debug__log_8hpp_afde3f42696113719c9ae35507125ee6e}{debug\_log}}(\textcolor{stringliteral}{"{}[allocate] allocated \%zu bytes @ \%p (Thread \%zu Subpool \%zu)\(\backslash\)n"{}}, n\_bytes, address, thread\_id(),}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00107}00107               m\_subpools.size());}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00108}00108     \textcolor{keywordflow}{return} address;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00109}00109 \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00110}00110 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00111}00111 \textcolor{keyword}{template} <\textcolor{keywordtype}{bool} merge>}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00112}\mbox{\hyperlink{classqalloc_1_1pool__base__t_a9998ab7bb3fc5a33d1556882ba257774}{00112}} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} pool\_base\_t::deallocate(\mbox{\hyperlink{namespaceqalloc_ae3a2d1ddce51c70146088378000a5946}{byte\_pointer}} p, \mbox{\hyperlink{namespaceqalloc_a5b36ec8e13ab5c8aebd049e1b0e07574}{size\_type}} n\_bytes)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00113}00113     \mbox{\hyperlink{defs_8hpp_a9be58a357a6e5331cf1ea72c7a65f315}{QALLOC\_ASSERT}}(p != \textcolor{keyword}{nullptr});}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00114}00114     \mbox{\hyperlink{defs_8hpp_a9be58a357a6e5331cf1ea72c7a65f315}{QALLOC\_ASSERT}}(n\_bytes > 0);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00115}00115     \mbox{\hyperlink{defs_8hpp_a9be58a357a6e5331cf1ea72c7a65f315}{QALLOC\_ASSERT}}(is\_valid(p));}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00116}00116 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00117}00117     \textcolor{keywordflow}{if} (m\_freed\_blocks.empty()) \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00118}00118         m\_freed\_blocks.emplace\_back(\mbox{\hyperlink{structqalloc_1_1freed__block__t}{freed\_block\_t}}\{n\_bytes, p\});}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00119}00119     \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00120}00120     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00121}00121         \mbox{\hyperlink{structqalloc_1_1freed__block__t}{freed\_block\_t}} freed\_block\{n\_bytes, p\};}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00122}00122         \textcolor{comment}{// make sure the freed block is sorted by address in ascending order (in order to merge blocks)}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00123}00123         \textcolor{keyword}{auto} insert\_pos = std::lower\_bound(m\_freed\_blocks.begin(), m\_freed\_blocks.end(), freed\_block, freed\_block\_t::less);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00124}00124         \mbox{\hyperlink{defs_8hpp_ac985d9b598dc1aad574c5db6759db7cf}{QALLOC\_IF\_CONSTEXPR}}(merge) \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00125}00125             \textcolor{keywordflow}{if} (insert\_pos != m\_freed\_blocks.end() \&\& freed\_block.is\_adjacent\_to(*insert\_pos)) \{ \textcolor{comment}{// is adjacent to the next block}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00126}00126                 \mbox{\hyperlink{debug__log_8hpp_afde3f42696113719c9ae35507125ee6e}{debug\_log}}(\textcolor{stringliteral}{"{}[deallocate] merged \%p (\%zu bytes) and \%p (\%zu bytes) into \%zu bytes (Thread \%zu)\(\backslash\)n"{}}, p, n\_bytes,}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00127}00127                         insert\_pos-\/>address, insert\_pos-\/>n\_bytes, insert\_pos-\/>n\_bytes + n\_bytes, thread\_id());}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00128}00128                 \textcolor{comment}{// merge with the next block}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00129}00129                 insert\_pos-\/>n\_bytes += n\_bytes;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00130}00130                 insert\_pos-\/>address = p;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00131}00131 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00132}00132                 \textcolor{keywordflow}{if} (m\_freed\_blocks.size() > 1\_z) \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00133}00133                     \textcolor{comment}{// iterate from the second block}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00134}00134                     insert\_pos = m\_freed\_blocks.begin() + 1;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00135}00135                     \textcolor{keywordflow}{while} (insert\_pos != m\_freed\_blocks.end()) \{ \textcolor{comment}{// is adjacent to the previous block}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00136}00136                         \textcolor{keyword}{auto} prev = insert\_pos -\/ 1;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00137}00137                         \textcolor{keywordflow}{if} (prev-\/>is\_adjacent\_to(*insert\_pos)) \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00138}00138                             \mbox{\hyperlink{debug__log_8hpp_afde3f42696113719c9ae35507125ee6e}{debug\_log}}(\textcolor{stringliteral}{"{}[deallocate] merged \%p (\%zu bytes) and \%p (\%zu bytes) into \%zu bytes (Thread \%zu)\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00139}00139                                     prev-\/>address, prev-\/>n\_bytes, insert\_pos-\/>address, insert\_pos-\/>n\_bytes,}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00140}00140                                     prev-\/>n\_bytes + insert\_pos-\/>n\_bytes, thread\_id());}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00141}00141                             \textcolor{comment}{// merge with the previous block}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00142}00142                             prev-\/>n\_bytes += insert\_pos-\/>n\_bytes;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00143}00143                             insert\_pos = m\_freed\_blocks.erase(insert\_pos);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00144}00144                         \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00145}00145                         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00146}00146                             ++insert\_pos;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00147}00147                         \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00148}00148                     \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00149}00149                 \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00150}00150                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00151}00151             \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00152}00152         \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00153}00153         \textcolor{comment}{// no block to merge with, insert the freed block}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00154}00154         \mbox{\hyperlink{debug__log_8hpp_afde3f42696113719c9ae35507125ee6e}{debug\_log}}(\textcolor{stringliteral}{"{}[deallocate] deallocated \%zu bytes @ \%p (Thread \%zu Subpool \%zu)\(\backslash\)n"{}}, n\_bytes, p, thread\_id(),}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00155}00155                   m\_subpools.size());}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00156}00156         m\_freed\_blocks.emplace(insert\_pos, freed\_block);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00157}00157     \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00158}00158 \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00159}00159 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00160}\mbox{\hyperlink{classqalloc_1_1pool__base__t_a2c4460825a397ff7d060b4630d1c7a8d}{00160}} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} pool\_base\_t::add\_subpool(\mbox{\hyperlink{namespaceqalloc_a5b36ec8e13ab5c8aebd049e1b0e07574}{size\_type}} n\_bytes)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00161}00161     \mbox{\hyperlink{debug__log_8hpp_afde3f42696113719c9ae35507125ee6e}{debug\_log}}(\textcolor{stringliteral}{"{}[allocate] adding new subpool with size \%zu (Thread \%zu Subpool \%zu)\(\backslash\)n"{}}, n\_bytes, thread\_id(),}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00162}00162               m\_subpools.size());}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00163}00163     \textcolor{comment}{// if there is space left in current subpool}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00164}00164     \textcolor{keywordflow}{if} (m\_cur\_subpool-\/>end != m\_cur\_subpool-\/>pos) \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00165}00165         \mbox{\hyperlink{debug__log_8hpp_afde3f42696113719c9ae35507125ee6e}{debug\_log}}(\textcolor{stringliteral}{"{}[allocate] subpool \%zu has \%zu bytes left @ \%p (Thread \%zu)\(\backslash\)n"{}}, m\_subpools.size(),}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00166}00166                   m\_cur\_subpool-\/>end -\/ m\_cur\_subpool-\/>pos, m\_cur\_subpool-\/>pos, thread\_id());}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00167}00167         \textcolor{comment}{// mark it as freed}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00168}00168         deallocate<false>(m\_cur\_subpool-\/>pos, \mbox{\hyperlink{namespaceqalloc_a9b6a3324c716b59468f390dbe4e9a1bc}{size\_cast}}(m\_cur\_subpool-\/>end -\/ m\_cur\_subpool-\/>pos));}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00169}00169     \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00170}00170     \textcolor{comment}{// add new subpool}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00171}00171     m\_subpools.emplace\_back(new\_subpool(n\_bytes));}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00172}00172     m\_cur\_subpool = \&m\_subpools.back();}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00173}00173     m\_pool\_total += n\_bytes;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00174}00174 \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00175}00175 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00176}\mbox{\hyperlink{classqalloc_1_1pool__base__t_aeea42a4a3dbd3524efdf2f9dfcd36440}{00176}} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{bool} pool\_base\_t::can\_allocate(\mbox{\hyperlink{namespaceqalloc_a5b36ec8e13ab5c8aebd049e1b0e07574}{size\_type}} n\_bytes) \textcolor{keyword}{const} \textcolor{keyword}{noexcept} \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00177}00177     \textcolor{keywordflow}{return} m\_cur\_subpool-\/>pos + n\_bytes <= m\_cur\_subpool-\/>end;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00178}00178 \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00179}00179 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00180}\mbox{\hyperlink{classqalloc_1_1pool__base__t_ad4acc3cd160d3fb95124099babf5c9e2}{00180}} \mbox{\hyperlink{namespaceqalloc_a5b36ec8e13ab5c8aebd049e1b0e07574}{size\_type}} pool\_base\_t::bytes\_used() const noexcept \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00181}00181     \textcolor{keywordtype}{size\_t} bytes\_used = m\_pool\_total;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00182}00182     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& block : m\_freed\_blocks) \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00183}00183         bytes\_used -\/= block.n\_bytes;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00184}00184     \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00185}00185     bytes\_used -\/= \mbox{\hyperlink{namespaceqalloc_a9b6a3324c716b59468f390dbe4e9a1bc}{size\_cast}}(m\_cur\_subpool-\/>end -\/ m\_cur\_subpool-\/>pos);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00186}00186     \textcolor{keywordflow}{return} bytes\_used;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00187}00187 \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00188}00188 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00189}\mbox{\hyperlink{classqalloc_1_1pool__base__t_a002cbf9acc35286cb2baac259be84eb9}{00189}} \textcolor{keyword}{constexpr} \mbox{\hyperlink{namespaceqalloc_a5b36ec8e13ab5c8aebd049e1b0e07574}{size\_type}} pool\_base\_t::pool\_size() const noexcept \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00190}00190     \textcolor{keywordflow}{return} m\_pool\_total;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00191}00191 \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00192}00192 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00193}\mbox{\hyperlink{classqalloc_1_1pool__base__t_a18a7ffc505668538e5acc52d3bb91829}{00193}} \textcolor{keywordtype}{bool} pool\_base\_t::is\_valid(\mbox{\hyperlink{namespaceqalloc_a01158dc1896ab43737138392524e61d9}{void\_pointer}} p) \textcolor{keyword}{const} \textcolor{keyword}{noexcept} \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00194}00194     \textcolor{keywordflow}{return} std::any\_of(}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00195}00195         m\_subpools.begin(),}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00196}00196         m\_subpools.end(),}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00197}00197         [p](\textcolor{keyword}{const} \mbox{\hyperlink{structqalloc_1_1subpool__t}{subpool\_t}}\& subpool) \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00198}00198             return pointer::in\_range(p, subpool.begin, subpool.end);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00199}00199         \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00200}00200     );}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00201}00201 \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00202}00202 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00203}\mbox{\hyperlink{namespaceqalloc_a478fbcc6943b47af975a08e4b61e91fe}{00203}} \mbox{\hyperlink{defs_8hpp_a3867648fe5c1dfaa0e9aa9de03c7c663}{QALLOC\_MALLOC\_FUNCTION}}(}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00204}00204         \mbox{\hyperlink{namespaceqalloc_a01158dc1896ab43737138392524e61d9}{void\_pointer}} pool\_base\_t::operator \textcolor{keyword}{new}(\mbox{\hyperlink{namespaceqalloc_a5b36ec8e13ab5c8aebd049e1b0e07574}{size\_type}} n\_bytes)) \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00205}00205     \textcolor{keywordflow}{return} \mbox{\hyperlink{namespaceqalloc_a3814825bf67bbfcbb1078b176f47333e}{q\_malloc}}(n\_bytes);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00206}00206 \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00207}00207 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00208}\mbox{\hyperlink{classqalloc_1_1pool__base__t_a17cfe03bbf0e1191e8e543e036baa49f}{00208}} \textcolor{keywordtype}{void} pool\_base\_t::operator \textcolor{keyword}{delete}(\mbox{\hyperlink{defs_8hpp_abd9d01a9bdcdb529f52d7d9e3e44b552}{QALLOC\_RESTRICT}} \mbox{\hyperlink{namespaceqalloc_a01158dc1896ab43737138392524e61d9}{void\_pointer}} p) \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00209}00209     \mbox{\hyperlink{memory_8hpp_a3dd12bc4507909ad9e011d4cb70d9ce2}{q\_free}}(p);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00210}00210 \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00211}00211 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00212}00212 \textcolor{comment}{// debug}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00213}\mbox{\hyperlink{classqalloc_1_1pool__base__t_a632add52224a63b667e4ca76cee0e324}{00213}} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} pool\_base\_t::print\_info(\textcolor{keywordtype}{bool} usage\_only)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00214}00214     \mbox{\hyperlink{defs_8hpp_afa317ae078e3aa6464f612d9d5c3cda1}{QALLOC\_PRINTF}}(\textcolor{stringliteral}{"{}Memory Pool:"{}});}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00215}00215     \mbox{\hyperlink{namespaceqalloc_a5b36ec8e13ab5c8aebd049e1b0e07574}{size\_type}} bytes\_used = this-\/>bytes\_used();}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00216}00216     \mbox{\hyperlink{defs_8hpp_afa317ae078e3aa6464f612d9d5c3cda1}{QALLOC\_PRINTF}}(\textcolor{stringliteral}{"{}  Usage: \%zu of \%zu bytes"{}}, bytes\_used, pool\_size());}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00217}00217     \textcolor{keywordflow}{if} (pool\_size() != 0\_z) \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00218}00218         \mbox{\hyperlink{defs_8hpp_afa317ae078e3aa6464f612d9d5c3cda1}{QALLOC\_PRINTF}}(\textcolor{stringliteral}{"{} (\%zu\%\%)\(\backslash\)n"{}}, bytes\_used * 100 / pool\_size());}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00219}00219     \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00220}00220     \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00221}00221         \mbox{\hyperlink{defs_8hpp_afa317ae078e3aa6464f612d9d5c3cda1}{QALLOC\_PRINTF}}(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00222}00222     \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00223}00223     \textcolor{keywordflow}{if} (usage\_only) \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00224}00224         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00225}00225     \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00226}00226     \mbox{\hyperlink{defs_8hpp_afa317ae078e3aa6464f612d9d5c3cda1}{QALLOC\_PRINTF}}(\textcolor{stringliteral}{"{}  Subpools: \(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00227}00227     \textcolor{keywordtype}{int} i = 1;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00228}00228     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& pool : m\_subpools) \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00229}00229         \textcolor{keywordflow}{if} (pool.begin == \textcolor{keyword}{nullptr}) \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00230}00230             \mbox{\hyperlink{defs_8hpp_afa317ae078e3aa6464f612d9d5c3cda1}{QALLOC\_PRINTF}}(\textcolor{stringliteral}{"{}    \%d: released by gc\(\backslash\)n"{}}, i);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00231}00231         \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00232}00232         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00233}00233             \mbox{\hyperlink{defs_8hpp_afa317ae078e3aa6464f612d9d5c3cda1}{QALLOC\_PRINTF}}(\textcolor{stringliteral}{"{}    \%d: \%p \string~ \%p (\%zu bytes)\(\backslash\)n"{}}, i, pool.begin, pool.end, pool.size);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00234}00234             \mbox{\hyperlink{defs_8hpp_afa317ae078e3aa6464f612d9d5c3cda1}{QALLOC\_PRINTF}}(\textcolor{stringliteral}{"{}      Position @ \%p\(\backslash\)n"{}}, pool.pos);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00235}00235         \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00236}00236         ++i;}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00237}00237     \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00238}00238     \textcolor{keyword}{auto}\& last\_subpool = m\_subpools.back();}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00239}00239     \textcolor{keywordflow}{if} (last\_subpool.pos != last\_subpool.end) \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00240}00240         \mbox{\hyperlink{defs_8hpp_afa317ae078e3aa6464f612d9d5c3cda1}{QALLOC\_PRINTF}}(\textcolor{stringliteral}{"{}      \%zu bytes unused\(\backslash\)n"{}}, \mbox{\hyperlink{namespaceqalloc_a9b6a3324c716b59468f390dbe4e9a1bc}{size\_cast}}(last\_subpool.end -\/ last\_subpool.pos));}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00241}00241     \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00242}00242     \mbox{\hyperlink{defs_8hpp_afa317ae078e3aa6464f612d9d5c3cda1}{QALLOC\_PRINTF}}(\textcolor{stringliteral}{"{}\(\backslash\)n  Deallocated blocks:\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00243}00243     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& block : m\_freed\_blocks) \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00244}00244         \textcolor{keyword}{auto} allocated\_block = block\_info\_t::at(block.address);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00245}00245         \mbox{\hyperlink{defs_8hpp_afa317ae078e3aa6464f612d9d5c3cda1}{QALLOC\_PRINTF}}(\textcolor{stringliteral}{"{}    \%p: \%zu bytes\(\backslash\)n"{}}, block.address, block.n\_bytes);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00246}00246         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespaceqalloc_a9b6a3324c716b59468f390dbe4e9a1bc}{size\_cast}}(allocated\_block-\/>subpool\_index) <= m\_subpools.size()) \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00247}00247             \mbox{\hyperlink{defs_8hpp_afa317ae078e3aa6464f612d9d5c3cda1}{QALLOC\_PRINTF}}(\textcolor{stringliteral}{"{}      Subpool: \%zu, type: "{}}, \mbox{\hyperlink{namespaceqalloc_a9b6a3324c716b59468f390dbe4e9a1bc}{size\_cast}}(allocated\_block-\/>subpool\_index) + 1);}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00248}00248             \textcolor{keywordflow}{if} (allocated\_block-\/>is\_valid()) \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00249}00249                 \textcolor{keyword}{auto} type\_name = \mbox{\hyperlink{namespaceqalloc_a21ba5c580f374d43d6ae7e251f6d8c22}{demangled\_type\_name\_of}}(allocated\_block-\/>type\_info-\/>name());}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00250}00250                 \mbox{\hyperlink{defs_8hpp_afa317ae078e3aa6464f612d9d5c3cda1}{QALLOC\_PRINTF}}(\textcolor{stringliteral}{"{}\%s\(\backslash\)n"{}}, type\_name.c\_str());}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00251}00251             \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00252}00252             \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00253}00253                 \mbox{\hyperlink{defs_8hpp_afa317ae078e3aa6464f612d9d5c3cda1}{QALLOC\_PRINTF}}(\textcolor{stringliteral}{"{}N/A\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00254}00254             \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00255}00255         \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00256}00256         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00257}00257             \mbox{\hyperlink{defs_8hpp_afa317ae078e3aa6464f612d9d5c3cda1}{QALLOC\_PRINTF}}(\textcolor{stringliteral}{"{}      Subpool: N/A, type: N/A\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00258}00258         \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00259}00259     \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00260}00260     \mbox{\hyperlink{defs_8hpp_afa317ae078e3aa6464f612d9d5c3cda1}{QALLOC\_PRINTF}}(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00261}00261 \}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00262}00262 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00263}00263 \mbox{\hyperlink{defs_8hpp_ae6074cc5b731bee29a970dd996470029}{QALLOC\_END}}}
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00264}00264 }
\DoxyCodeLine{\Hypertarget{pool__base__impl_8hpp_source_l00265}00265 \textcolor{preprocessor}{\#endif }\textcolor{comment}{//QALLOC\_POOL\_BASE\_IMPL\_HPP}}

\end{DoxyCode}
